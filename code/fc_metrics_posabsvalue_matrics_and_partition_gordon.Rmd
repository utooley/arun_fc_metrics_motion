---
title: "FC Metrics Susceptibility to Motion- Positive and Abs Value Edge Weights"
output:
  html_document:
    theme: united
    toc: yes
    toc_depth: 6
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(psych)
library(gam)
library(summarytools)
library(PerformanceAnalytics)
library(ppcor)
library(reshape2)
library(R.matlab)
library(ggplot2)
```

# Gordon Parcellation
## Look at raw modularity calculated using the a priori partition

```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Gordon_ICA_FIX/"
run1_data=read.csv(paste0(dropbox_data, "modularity_raw_REST1_LR_060319.csv"))
run2_data=read.csv(paste0(dropbox_data, "modularity_raw_REST1_RL_060319.csv"))
run3_data=read.csv(paste0(dropbox_data, "modularity_raw_REST2_LR_060319.csv"))
run4_data=read.csv(paste0(dropbox_data, "modularity_raw_REST2_RL_060319.csv"))
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, run1_data)
alldata1 <- merge(modul_data1, motiondata1, by = "subject", all = TRUE)
alldata1 <- alldata1 %>% filter(., num_communities_Pearson != 0)
#recode age to be the median of the bins that are provided
alldata1$Age_numeric <- dplyr::recode(alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, run2_data)
alldata2 <- merge(modul_data2, motiondata2, by = "subject", all = TRUE)
alldata2 <- alldata2 %>% filter(., num_communities_Pearson != 0)
#recode age to be the median of the bins that are provided
alldata2$Age_numeric <- dplyr::recode(alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, run3_data)
alldata3 <- merge(modul_data3, motiondata3, by = "subject", all = TRUE)
alldata3 <- alldata3 %>% filter(., num_communities_Pearson != 0)
alldata3 <- na.omit(alldata3)
#recode age to be the median of the bins that are provided
alldata3$Age_numeric <- dplyr::recode(alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data4 <- data.frame(subject_list, run4_data)
alldata4 <- merge(modul_data4, motiondata4, by = "subject", all = TRUE)
alldata4 <- alldata4 %>% filter(., num_communities_Pearson != 0)
alldata4 <- na.omit(alldata4)
#recode age to be the median of the bins that are provided
alldata4$Age_numeric <- dplyr::recode(alldata4$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
```

## Import raw modularity calculated using the a priori partition
Merge with orig files.
IMPORTANT: There was a bug in the matlab script which means that later runs have values for modularity for subjects that are not there, because modul was not cleared out between loops. This only applies to the re-ranked matrices run using the Schaefer parcellation, which were run all in one loop, so here we avoid it by merging into the original files which have the right number of subjects.
```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Gordon_ICA_FIX/"
rerank_run1_data=readMat(paste0(dropbox_data, "modul_gordon_partition1.mat"))
rerank_run1_data <- data.frame(matrix(unlist(rerank_run1_data$modul, use.names = FALSE), nrow=length(rerank_run1_data$modul[[1]]), byrow=F))
colnames(rerank_run1_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run2_data=readMat(paste0(dropbox_data, "modul_gordon_partition2.mat"))
rerank_run2_data <- data.frame(matrix(unlist(rerank_run2_data$modul, use.names = FALSE), nrow=length(rerank_run2_data$modul[[1]]), byrow=F))
colnames(rerank_run2_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run3_data=readMat(paste0(dropbox_data, "modul_gordon_partition3.mat"))
rerank_run3_data <- data.frame(matrix(unlist(rerank_run3_data$modul, use.names = FALSE), nrow=length(rerank_run3_data$modul[[1]]), byrow=F))
colnames(rerank_run3_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
# rerank_run4_data=readMat(paste0(dropbox_data, "modul_gordon_partition4.mat"))
# rerank_run4_data <- data.frame(matrix(unlist(rerank_run4_data$modul, use.names = FALSE), nrow=length(rerank_run4_data$modul[[1]]), byrow=F))
# colnames(rerank_run4_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
#merge them with the original data files so that they have the right number of submects
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, rerank_run1_data)
rerank_alldata1 <- merge(modul_data1, alldata1, by = "subject", all = TRUE)
rerank_alldata1 <- rerank_alldata1 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata1$Age_numeric <- dplyr::recode(rerank_alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, rerank_run2_data)
rerank_alldata2 <- merge(modul_data2, alldata2, by = "subject", all = TRUE)
rerank_alldata2 <- rerank_alldata2 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata2$Age_numeric <- dplyr::recode(rerank_alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, rerank_run3_data)
rerank_alldata3 <- merge(modul_data3, alldata3, by = "subject", all = TRUE)
rerank_alldata3 <- rerank_alldata3 %>% filter(., Pearson != 0)
rerank_alldata3 <- na.omit(rerank_alldata3)
#recode age to be the median of the bins that are provided
#rerank_alldata3$Age_numeric <- dplyr::recode(rerank_alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
# mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
# motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
# modul_data4 <- data.frame(subject_list, rerank_run4_data)
# rerank_alldata4 <- merge(modul_data4, alldata4, by = "subject", all = TRUE)
# rerank_alldata4 <- rerank_alldata4 %>% filter(.,Pearson != 0)
# rerank_alldata4 <- na.omit(rerank_alldata4)
```

## Look at raw modularity calculated using the a priori partition

```{r modularity motion, echo=TRUE}

# #calculate the relationship between raw modularity and motion for each of the 4 runs
# for (i in 1:4){
#   assign("data",get(paste0("rerank_alldata",i)))
#   rawcorr_modul<- lapply(data[12:17], function(eachFormula) {cor.test(eachFormula, data$motion, method="kendall")})
#   rawcorr_modul_estimate<- lapply(data[12:17], function(eachFormula) {cor.test(eachFormula, data$motion, method="kendall")$estimate})
#   motionavgweight_corr_estimate <- lapply(data[6:11], function(eachFormula) {cor.test(eachFormula, data$motion, method="kendall")$estimate})
#   rawmotionmodul_corr <- data.frame(names(data)[12:17], unlist(rawcorr_modul_estimate))
#   motionavgweight_corr <- data.frame(names(data)[6:11], unlist(motionavgweight_corr_estimate))
#   assign(paste0("rawmotioncorr_tauestimate_run",i),rawmotionmodul_corr)
#   assign(paste0("motionavgweight_corr_run",i),motionavgweight_corr)
# }
# 
# 
# #average them together
# averaged_rawmotioncorr_acrossruns <- numeric()
# averaged_rawmotioncorr_acrossruns$estimate <-(rawmotioncorr_tauestimate_run1$unlist.rawcorr_modul_estimate.+rawmotioncorr_tauestimate_run2$unlist.rawcorr_modul_estimate.+rawmotioncorr_tauestimate_run3$unlist.rawcorr_modul_estimate.+rawmotioncorr_tauestimate_run4$unlist.rawcorr_modul_estimate.)/4
# averaged_rawmotioncorr_acrossruns$names <- unlist(strsplit(names(alldata1)[12:17], "_"))[2*(1:length(names(alldata1[,12:17])))]
# 
# barplot(averaged_rawmotioncorr_acrossruns$estimate, names.arg =averaged_rawmotioncorr_acrossruns$names, ylim=c(0, -0.08), col="blue", cex.axis=1.5, cex.names=1)


#Make a barplot of raw modularity
toplot <- dplyr::select(rerank_alldata3, Coherence:WaveletCoherence) 
toplot <- melt(toplot)
p<-ggplot(toplot, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(width = 0.4, position = position_dodge(width=0.5), stat="summary", fun.y=mean)+ 
  theme_classic() 
p
+ labs(title="100-node Yeo parcellation",x="Baseline Edge weight distribution", y = "Modularity quality index Q")+ theme(plot.title = element_text(hjust = 0.5))+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14))

```

## Import modularity calculated using the absolute value matrices
```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Gordon_ICA_FIX/abs_value_PearsonSpearman/"
rerank_run1_data=readMat(paste0(dropbox_data, "modul_absvalue_run1.mat"))
rerank_run1_data <- data.frame(matrix(unlist(rerank_run1_data$modul, use.names = FALSE), nrow=length(rerank_run1_data$modul[[1]]), byrow=F))
colnames(rerank_run1_data) <- c('MutualInformation', 'Spearman','Coherence', 'MutualInformationTime','Pearson','WaveletCoherence')
rerank_run2_data=readMat(paste0(dropbox_data, "modul_absvalue_run2.mat"))
rerank_run2_data <- data.frame(matrix(unlist(rerank_run2_data$modul, use.names = FALSE), nrow=length(rerank_run2_data$modul[[1]]), byrow=F))
colnames(rerank_run2_data) <- c('MutualInformation', 'Spearman','Coherence', 'MutualInformationTime','Pearson','WaveletCoherence')
rerank_run3_data=readMat(paste0(dropbox_data, "modul_absvalue_run3.mat"))
rerank_run3_data <- data.frame(matrix(unlist(rerank_run3_data$modul, use.names = FALSE), nrow=length(rerank_run3_data$modul[[1]]), byrow=F))
colnames(rerank_run3_data) <- c('MutualInformation', 'Spearman','Coherence', 'MutualInformationTime','Pearson','WaveletCoherence')
rerank_run4_data=readMat(paste0(dropbox_data, "modul_absvalue_run4.mat"))
rerank_run4_data <- data.frame(matrix(unlist(rerank_run4_data$modul, use.names = FALSE), nrow=length(rerank_run4_data$modul[[1]]), byrow=F))
colnames(rerank_run4_data) <- c('MutualInformation', 'Spearman','Coherence', 'MutualInformationTime','Pearson','WaveletCoherence')
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
#merge them with the original data files so that they have the right number of submects
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, rerank_run1_data)
rerank_alldata1 <- merge(modul_data1, alldata1, by = "subject", all = TRUE)
rerank_alldata1 <- rerank_alldata1 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata1$Age_numeric <- dplyr::recode(rerank_alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, rerank_run2_data)
rerank_alldata2 <- merge(modul_data2, alldata2, by = "subject", all = TRUE)
rerank_alldata2 <- rerank_alldata2 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata2$Age_numeric <- dplyr::recode(rerank_alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, rerank_run3_data)
rerank_alldata3 <- merge(modul_data3, alldata3, by = "subject", all = TRUE)
rerank_alldata3 <- rerank_alldata3 %>% filter(., Pearson != 0)
rerank_alldata3 <- na.omit(rerank_alldata3)
#recode age to be the median of the bins that are provided
#rerank_alldata3$Age_numeric <- dplyr::recode(rerank_alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data4 <- data.frame(subject_list, rerank_run4_data)
rerank_alldata4 <- merge(modul_data4, alldata4, by = "subject", all = TRUE)
rerank_alldata4 <- rerank_alldata4 %>% filter(.,Pearson != 0)
rerank_alldata4 <- na.omit(rerank_alldata4)
```

```{r modularity motion, echo=TRUE}
#Make a barplot of abs value modularity
toplot <- dplyr::select(rerank_alldata4,Pearson, Spearman, modul_Coherence:modul_MutualInformationTime) 
toplot <- melt(toplot)
p<-ggplot(toplot, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(width = 0.4, position = position_dodge(width=0.5), stat="summary", fun.y=mean)+ 
  theme_classic() 
p
+ labs(title="100-node Yeo parcellation",x="Baseline Edge weight distribution", y = "Modularity quality index Q")+ theme(plot.title = element_text(hjust = 0.5))+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14))
```

## Just plot raw modularity across metrics

```{r plot of raw modularity across different metrics}
metrics=c("Pearson", "Spearman", "Coherence", "WaveletCoherence", "MutualInformation","MutualInformationTime")
#calculate the relationship between raw modularity and motion for each of the 4 runs
for (i in 1:4){
  assign("data",get(paste0("rerank_alldata",i)))
  mean_modul=numeric(6)
   for (l in 1:6){
    assign("metric", metrics[l])
    temp <- data %>% dplyr::select(.,matches(paste0("^",metric,"$")))
    #print(colnames(temp))
    # temp2 <- cbind(temp$Age_numeric, temp[3])
    mean_modul[l]<- mean(temp[,1])
     
   }
    assign(paste0("mean_modul_estimate_run",i),data.frame(mean_modul, metrics))
}
#beeswarm plot
#Melt them together
all <- cbind(mean_modul_estimate_run1, mean_modul_estimate_run2, mean_modul_estimate_run3, mean_modul_estimate_run4)
all$metrics <- factor(all$metrics, levels=c("Pearson", "Spearman", "Coherence", "WaveletCoherence", "MutualInformation","MutualInformationTime"), labels=c("P", "S", "MIT", "C","WC", "MIF") )
colnames(all) <- c("estimate1", "metrics", "estimate2","metrics", "estimate3", "metrics","estimate4", "metrics")
all <- melt(all, id.vars = "metrics")
#Plot them like Arun, using his colors
p<-ggplot(all, aes(x=metrics, y=value, color=metrics)) + 
  geom_jitter(position=position_jitter(0.2), cex=2.5)
p + theme_classic() + stat_summary(fun.data="mean_sdl",fun.args = list(mult = 1) ,
                 geom="pointrange", shape=95, cex=1) + labs(title="333-node Gordon parcellation",x="", y = "Modularity quality index (Q)")+ theme(plot.title = element_text(hjust = 0.5), legend.position = "none")+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14)) +scale_color_manual(values=c("#0072BD", "#D95319", "#EDB120", "#7E2F8E", "#77AC30", "#4DBEEE"))
```

## Import modularity calculated using the absolute value matrices on the gordon partition
```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Gordon_ICA_FIX/abs_value_PearsonSpearman/"
rerank_run1_data=readMat(paste0(dropbox_data, "modul_absvalue_gordon_partition1.mat"))
rerank_run1_data <- data.frame(matrix(unlist(rerank_run1_data$modul, use.names = FALSE), nrow=length(rerank_run1_data$modul[[1]]), byrow=F))
colnames(rerank_run1_data) <-  c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run2_data=readMat(paste0(dropbox_data, "modul_absvalue_gordon_partition2.mat"))
rerank_run2_data <- data.frame(matrix(unlist(rerank_run2_data$modul, use.names = FALSE), nrow=length(rerank_run2_data$modul[[1]]), byrow=F))
colnames(rerank_run2_data) <-  c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run3_data=readMat(paste0(dropbox_data, "modul_absvalue_gordon_partition3.mat"))
rerank_run3_data <- data.frame(matrix(unlist(rerank_run3_data$modul, use.names = FALSE), nrow=length(rerank_run3_data$modul[[1]]), byrow=F))
colnames(rerank_run3_data) <-  c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run4_data=readMat(paste0(dropbox_data, "modul_absvalue_gordon_partition4.mat"))
rerank_run4_data <- data.frame(matrix(unlist(rerank_run4_data$modul, use.names = FALSE), nrow=length(rerank_run4_data$modul[[1]]), byrow=F))
colnames(rerank_run4_data) <-  c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
#merge them with the original data files so that they have the right number of submects
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, rerank_run1_data)
rerank_alldata1 <- merge(modul_data1, alldata1, by = "subject", all = TRUE)
rerank_alldata1 <- rerank_alldata1 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata1$Age_numeric <- dplyr::recode(rerank_alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, rerank_run2_data)
rerank_alldata2 <- merge(modul_data2, alldata2, by = "subject", all = TRUE)
rerank_alldata2 <- rerank_alldata2 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata2$Age_numeric <- dplyr::recode(rerank_alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, rerank_run3_data)
rerank_alldata3 <- merge(modul_data3, alldata3, by = "subject", all = TRUE)
rerank_alldata3 <- rerank_alldata3 %>% filter(., Pearson != 0)
rerank_alldata3 <- na.omit(rerank_alldata3)
#recode age to be the median of the bins that are provided
#rerank_alldata3$Age_numeric <- dplyr::recode(rerank_alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data4 <- data.frame(subject_list, rerank_run4_data)
rerank_alldata4 <- merge(modul_data4, alldata4, by = "subject", all = TRUE)
rerank_alldata4 <- rerank_alldata4 %>% filter(.,Pearson != 0)
rerank_alldata4 <- na.omit(rerank_alldata4)
```

```{r modularity motion, echo=TRUE}

#Make a barplot of abs value modularity
toplot <- dplyr::select(rerank_alldata4,Coherence:WaveletCoherence) 
toplot <- melt(toplot)
p<-ggplot(toplot, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(width = 0.4, position = position_dodge(width=0.5), stat="summary", fun.y=mean)+ 
  theme_classic() +theme(legend.position = "none")
p
+ labs(title="100-node Yeo parcellation",x="Baseline Edge weight distribution", y = "Modularity quality index Q")+ theme(plot.title = element_text(hjust = 0.5))+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14))
```

## Import modularity calculated using the positive matrices
```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Gordon_ICA_FIX/positive_only_PearsonSpearman/"
rerank_run1_data=readMat(paste0(dropbox_data, "modul_positiveonly_run1.mat"))
rerank_run1_data <- data.frame(matrix(unlist(rerank_run1_data$modul, use.names = FALSE), nrow=length(rerank_run1_data$modul[[1]]), byrow=F))
colnames(rerank_run1_data) <- c('Pearson','Spearman')
rerank_run2_data=readMat(paste0(dropbox_data, "modul_positiveonly_run2.mat"))
rerank_run2_data <- data.frame(matrix(unlist(rerank_run2_data$modul, use.names = FALSE), nrow=length(rerank_run2_data$modul[[1]]), byrow=F))
colnames(rerank_run2_data) <- c('Pearson','Spearman')
# rerank_run3_data=readMat(paste0(dropbox_data, "modul_absvalue_run3.mat"))
# rerank_run3_data <- data.frame(matrix(unlist(rerank_run3_data$modul, use.names = FALSE), nrow=length(rerank_run3_data$modul[[1]]), byrow=F))
# colnames(rerank_run3_data) <- c('Pearson','Spearman')
# rerank_run4_data=readMat(paste0(dropbox_data, "modul_absvalue_run4.mat"))
# rerank_run4_data <- data.frame(matrix(unlist(rerank_run4_data$modul, use.names = FALSE), nrow=length(rerank_run4_data$modul[[1]]), byrow=F))
# colnames(rerank_run4_data) <- c('Pearson','Spearman')
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
#merge them with the original data files so that they have the right number of submects
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, rerank_run1_data)
rerank_alldata1 <- merge(modul_data1, alldata1, by = "subject", all = TRUE)
rerank_alldata1 <- rerank_alldata1 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata1$Age_numeric <- dplyr::recode(rerank_alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, rerank_run2_data)
rerank_alldata2 <- merge(modul_data2, alldata2, by = "subject", all = TRUE)
rerank_alldata2 <- rerank_alldata2 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata2$Age_numeric <- dplyr::recode(rerank_alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
# mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
# motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
# modul_data3 <- data.frame(subject_list, rerank_run3_data)
# rerank_alldata3 <- merge(modul_data3, alldata3, by = "subject", all = TRUE)
# rerank_alldata3 <- rerank_alldata3 %>% filter(., Pearson != 0)
# rerank_alldata3 <- na.omit(rerank_alldata3)
# #recode age to be the median of the bins that are provided
# #rerank_alldata3$Age_numeric <- dplyr::recode(rerank_alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
# mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
# motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
# modul_data4 <- data.frame(subject_list, rerank_run4_data)
# rerank_alldata4 <- merge(modul_data4, alldata4, by = "subject", all = TRUE)
# rerank_alldata4 <- rerank_alldata4 %>% filter(.,Pearson != 0)
# rerank_alldata4 <- na.omit(rerank_alldata4)
```

```{r modularity motion, echo=TRUE}

#Make a barplot of abs value modularity
toplot <- dplyr::select(rerank_alldata2,Pearson, Spearman, modul_Coherence:modul_MutualInformationTime) 
toplot <- melt(toplot)
p<-ggplot(toplot, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(width = 0.4, position = position_dodge(width=0.5), stat="summary", fun.y=mean)+ 
  theme_classic() +theme(legend.position = "none")
p
+ labs(title="100-node Yeo parcellation",x="Baseline Edge weight distribution", y = "Modularity quality index Q")+ theme(plot.title = element_text(hjust = 0.5))+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14))
```

## Import positive-only matrices using the Gordon communities
```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Gordon_ICA_FIX/positive_only_PearsonSpearman/"
rerank_run1_data=readMat(paste0(dropbox_data, "modul_pose_gordon_partition1.mat"))
names <- row.names(rerank_run1_data$modul)
rerank_run1_data <- data.frame(matrix(unlist(rerank_run1_data$modul, use.names = FALSE), nrow=length(rerank_run1_data$modul[[1]]), byrow=F))
colnames(rerank_run1_data) <- names
rerank_run2_data=readMat(paste0(dropbox_data, "modul_pose_gordon_partition2.mat"))
names <- row.names(rerank_run2_data$modul)
rerank_run2_data <- data.frame(matrix(unlist(rerank_run2_data$modul, use.names = FALSE), nrow=length(rerank_run2_data$modul[[1]]), byrow=F))
colnames(rerank_run2_data) <- names
rerank_run3_data=readMat(paste0(dropbox_data, "modul_pose_gordon_partition3.mat"))
names <- row.names(rerank_run3_data$modul)
rerank_run3_data <- data.frame(matrix(unlist(rerank_run3_data$modul, use.names = FALSE), nrow=length(rerank_run3_data$modul[[1]]), byrow=F))
colnames(rerank_run3_data) <- names
rerank_run4_data=readMat(paste0(dropbox_data, "modul_positiveonly_gordon_partition4.mat"))
rerank_run4_data <- data.frame(matrix(unlist(rerank_run4_data$modul, use.names = FALSE), nrow=length(rerank_run4_data$modul[[1]]), byrow=F))
colnames(rerank_run4_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
#merge them with the original data files so that they have the right number of submects
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, rerank_run1_data)
rerank_alldata1 <- merge(modul_data1, alldata1, by = "subject", all = TRUE)
rerank_alldata1 <- rerank_alldata1 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata1$Age_numeric <- dplyr::recode(rerank_alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, rerank_run2_data)
rerank_alldata2 <- merge(modul_data2, alldata2, by = "subject", all = TRUE)
rerank_alldata2 <- rerank_alldata2 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata2$Age_numeric <- dplyr::recode(rerank_alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, rerank_run3_data)
rerank_alldata3 <- merge(modul_data3, alldata3, by = "subject", all = TRUE)
rerank_alldata3 <- rerank_alldata3 %>% filter(., Pearson != 0)
rerank_alldata3 <- na.omit(rerank_alldata3)
#recode age to be the median of the bins that are provided
#rerank_alldata3$Age_numeric <- dplyr::recode(rerank_alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data4 <- data.frame(subject_list, rerank_run4_data)
rerank_alldata4 <- merge(modul_data4, alldata4, by = "subject", all = TRUE)
rerank_alldata4 <- rerank_alldata4 %>% filter(.,Pearson != 0)
rerank_alldata4 <- na.omit(rerank_alldata4)
```

```{r modularity motion, echo=TRUE}

#Make a barplot of abs value modularity
toplot <- dplyr::select(rerank_alldata3,Coherence:WaveletCoherence) 
toplot <- melt(toplot)
p<-ggplot(toplot, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(width = 0.4, position = position_dodge(width=0.5), stat="summary", fun.y=mean)+ 
  theme_classic() +theme(legend.position = "none")
p
+ labs(title="100-node Yeo parcellation",x="Baseline Edge weight distribution", y = "Modularity quality index Q")+ theme(plot.title = element_text(hjust = 0.5))+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14))
```

# Schaefer Parcellation
## Look at raw modularity calculated using the a priori partition

```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Schaefer100_ICA_FIX/"
run1_data=read.csv(paste0(dropbox_data, "modularity_raw_REST1_LR_062419.csv"))
run2_data=read.csv(paste0(dropbox_data, "modularity_raw_REST1_RL_062419.csv"))
run3_data=read.csv(paste0(dropbox_data, "modularity_raw_REST2_LR_062419.csv"))
run4_data=read.csv(paste0(dropbox_data, "modularity_raw_REST2_RL_062419.csv"))
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, run1_data)
alldata1 <- merge(modul_data1, motiondata1, by = "subject", all = TRUE)
alldata1 <- alldata1 %>% filter(., num_communities_Pearson != 0)
#recode age to be the median of the bins that are provided
alldata1$Age_numeric <- dplyr::recode(alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, run2_data)
alldata2 <- merge(modul_data2, motiondata2, by = "subject", all = TRUE)
alldata2 <- alldata2 %>% filter(., num_communities_Pearson != 0)
#recode age to be the median of the bins that are provided
alldata2$Age_numeric <- dplyr::recode(alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, run3_data)
alldata3 <- merge(modul_data3, motiondata3, by = "subject", all = TRUE)
alldata3 <- alldata3 %>% filter(., num_communities_Pearson != 0)
alldata3 <- na.omit(alldata3)
#recode age to be the median of the bins that are provided
alldata3$Age_numeric <- dplyr::recode(alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data4 <- data.frame(subject_list, run4_data)
alldata4 <- merge(modul_data4, motiondata4, by = "subject", all = TRUE)
alldata4 <- alldata4 %>% filter(., num_communities_Pearson != 0)
alldata4 <- na.omit(alldata4)
#recode age to be the median of the bins that are provided
alldata4$Age_numeric <- dplyr::recode(alldata4$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
```

## Import modularity calculated using the absolute value matrices
```{r load data, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Schaefer100_ICA_FIX/abs_value_PearsonSpearman/"
rerank_run1_data=readMat(paste0(dropbox_data, "modul_absvalue_run1.mat"))
rerank_run1_data <- data.frame(matrix(unlist(rerank_run1_data$modul, use.names = FALSE), nrow=length(rerank_run1_data$modul[[1]]), byrow=F))
colnames(rerank_run1_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run2_data=readMat(paste0(dropbox_data, "modul_absvalue_run2.mat"))
rerank_run2_data <- data.frame(matrix(unlist(rerank_run2_data$modul, use.names = FALSE), nrow=length(rerank_run2_data$modul[[1]]), byrow=F))
colnames(rerank_run2_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run3_data=readMat(paste0(dropbox_data, "modul_absvalue_run3.mat"))
rerank_run3_data <- data.frame(matrix(unlist(rerank_run3_data$modul, use.names = FALSE), nrow=length(rerank_run3_data$modul[[1]]), byrow=F))
colnames(rerank_run3_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
rerank_run4_data=readMat(paste0(dropbox_data, "modul_absvalue_run4.mat"))
rerank_run4_data <- data.frame(matrix(unlist(rerank_run4_data$modul, use.names = FALSE), nrow=length(rerank_run4_data$modul[[1]]), byrow=F))
colnames(rerank_run4_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
#merge them with the original data files so that they have the right number of submects
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, rerank_run1_data)
rerank_alldata1 <- merge(modul_data1, alldata1, by = "subject", all = TRUE)
rerank_alldata1 <- rerank_alldata1 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata1$Age_numeric <- dplyr::recode(rerank_alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, rerank_run2_data)
rerank_alldata2 <- merge(modul_data2, alldata2, by = "subject", all = TRUE)
rerank_alldata2 <- rerank_alldata2 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#rerank_alldata2$Age_numeric <- dplyr::recode(rerank_alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, rerank_run3_data)
rerank_alldata3 <- merge(modul_data3, alldata3, by = "subject", all = TRUE)
rerank_alldata3 <- rerank_alldata3 %>% filter(., Pearson != 0)
rerank_alldata3 <- na.omit(rerank_alldata3)
#recode age to be the median of the bins that are provided
#rerank_alldata3$Age_numeric <- dplyr::recode(rerank_alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data4 <- data.frame(subject_list, rerank_run4_data)
rerank_alldata4 <- merge(modul_data4, alldata4, by = "subject", all = TRUE)
rerank_alldata4 <- rerank_alldata4 %>% filter(.,Pearson != 0)
rerank_alldata4 <- na.omit(rerank_alldata4)
```

```{r modularity motion, echo=TRUE}
#Make a barplot of abs value modularity
toplot <- dplyr::select(rerank_alldata4,Pearson, Spearman, modul_Coherence:modul_MutualInformationTime) 
toplot <- melt(toplot)
p<-ggplot(toplot, aes(x=variable, y=value, fill=variable)) + 
  geom_bar(width = 0.4, position = position_dodge(width=0.5), stat="summary", fun.y=mean)+ 
  theme_classic() 
p
+ labs(title="100-node Yeo parcellation",x="Baseline Edge weight distribution", y = "Modularity quality index Q")+ theme(plot.title = element_text(hjust = 0.5))+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14))
```

## Just plot raw modularity across metrics

```{r plot of raw modularity across different metrics}
metrics=c("Pearson", "Spearman", "Coherence", "WaveletCoherence", "MutualInformation","MutualInformationTime")
#calculate the relationship between raw modularity and motion for each of the 4 runs
for (i in 1:4){
  assign("data",get(paste0("rerank_alldata",i)))
  mean_modul=numeric(6)
   for (l in 1:6){
    assign("metric", metrics[l])
    temp <- data %>% dplyr::select(.,matches(paste0("^",metric,"$")))
    #print(colnames(temp))
    # temp2 <- cbind(temp$Age_numeric, temp[3])
    mean_modul[l]<- mean(temp[,1])
     
   }
    assign(paste0("mean_modul_estimate_run",i),data.frame(mean_modul, metrics))
}
#beeswarm plot
#Melt them together
all <- cbind(mean_modul_estimate_run1, mean_modul_estimate_run2, mean_modul_estimate_run3, mean_modul_estimate_run4)
all$metrics <- factor(all$metrics, levels=c("Pearson", "Spearman", "Coherence", "WaveletCoherence", "MutualInformation","MutualInformationTime"), labels=c("P", "S", "MIT", "C","WC", "MIF") )
colnames(all) <- c("estimate1", "metrics", "estimate2","metrics", "estimate3", "metrics","estimate4", "metrics")
all <- melt(all, id.vars = "metrics")
#Plot them like Arun, using his colors
p<-ggplot(all, aes(x=metrics, y=value, color=metrics)) + 
  geom_jitter(position=position_jitter(0.2), cex=2.5)
p + theme_classic() + stat_summary(fun.data="mean_sdl",fun.args = list(mult = 1) ,
                 geom="pointrange", shape=95, cex=1) + labs(title="100-node Yeo parcellation",x="", y = "Modularity quality index (Q)")+ theme(plot.title = element_text(hjust = 0.5), legend.position = "none")+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14)) +scale_color_manual(values=c("#0072BD", "#D95319", "#EDB120", "#7E2F8E", "#77AC30", "#4DBEEE"))
```

## Import nulls calculated using the absolute values of matrices

```{r load null abs valuedata, include=FALSE}
data_dir="~/Documents/projects/in_progress/arun_fc_metrics_motion/"
dropbox_data="~/Dropbox/projects/in_progress/arun_fc_metrics_motion/output/data/Schaefer100_ICA_FIX/abs_valuewith_nulls/"
null_run1_data=readMat(paste0(dropbox_data, "nullmodul_withnulls_run1.mat"))
null_run1_data <- data.frame(matrix(unlist(null_run1_data$null.modul, use.names = FALSE), nrow=length(null_run1_data$null.modul[[1]]), byrow=F))
colnames(null_run1_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
null_run2_data=readMat(paste0(dropbox_data, "nullmodul_withnulls_run2.mat"))
null_run2_data <- data.frame(matrix(unlist(null_run2_data$null.modul, use.names = FALSE), nrow=length(null_run2_data$null.modul[[1]]), byrow=F))
colnames(null_run2_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
null_run3_data=readMat(paste0(dropbox_data, "nullmodul_withnulls_run3.mat"))
null_run3_data <- data.frame(matrix(unlist(null_run3_data$null.modul, use.names = FALSE), nrow=length(null_run3_data$null.modul[[1]]), byrow=F))
colnames(null_run3_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
null_run4_data=readMat(paste0(dropbox_data, "nullmodul_withnulls_run4.mat"))
null_run4_data <- data.frame(matrix(unlist(null_run4_data$null.modul, use.names = FALSE), nrow=length(null_run4_data$null.modul[[1]]), byrow=F))
colnames(null_run4_data) <- c('Coherence', 'MutualInformation', 'MutualInformationTime','Pearson','Spearman', 'WaveletCoherence')
subject_list=read.csv(paste0(data_dir, "data/subjLists/S1200_Release_Subjects_Demographics.csv"))
subject_list <- subject_list %>% dplyr::select(.,Subject:Age) %>% rename(., subject=Subject)
#merge them with the original data files so that they have the right number of submects
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_LR/"
motiondata1 <- read.csv(paste0(mydir,"/rfMRI_REST1_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data1 <- data.frame(subject_list, null_run1_data)
null_alldata1 <- merge(modul_data1, alldata1, by = "subject", all = TRUE)
null_alldata1 <- null_alldata1 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#null_alldata1$Age_numeric <- dplyr::recode(null_alldata1$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST1_RL/"
motiondata2 <- read.csv(paste0(mydir,"/rfMRI_REST1_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data2 <- data.frame(subject_list, null_run2_data)
null_alldata2 <- merge(modul_data2, alldata2, by = "subject", all = TRUE)
null_alldata2 <- null_alldata2 %>% filter(., Pearson != 0)
#recode age to be the median of the bins that are provided
#null_alldata2$Age_numeric <- dplyr::recode(null_alldata2$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_LR/"
motiondata3 <- read.csv(paste0(mydir,"/rfMRI_REST2_LR.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data3 <- data.frame(subject_list, null_run3_data)
null_alldata3 <- merge(modul_data3, alldata3, by = "subject", all = TRUE)
null_alldata3 <- null_alldata3 %>% filter(., Pearson != 0)
null_alldata3 <- na.omit(null_alldata3)
#recode age to be the median of the bins that are provided
#null_alldata3$Age_numeric <- dplyr::recode(null_alldata3$Age, "22-25"= 23.5, "26-30"=28, "31-35"=33, "36+"=36)
mydir="~/Documents/projects/in_progress/arun_fc_metrics_motion/data/subjData/Motion_S1200/rfMRI_REST2_RL/"
motiondata4 <- read.csv(paste0(mydir,"/rfMRI_REST2_RL.csv"), header = FALSE, col.names = c("subject", "motion"))
modul_data4 <- data.frame(subject_list, null_run4_data)
null_alldata4 <- merge(modul_data4, alldata4, by = "subject", all = TRUE)
null_alldata4 <- null_alldata4 %>% filter(.,Pearson != 0)
null_alldata4 <- na.omit(null_alldata4)
```

## Compare raw modularity to nulls calculated for each metric

```{r plot of raw modularity across different metrics}
metrics=c("Pearson", "Spearman", "Coherence", "WaveletCoherence", "MutualInformation","MutualInformationTime")
#calculate the relationship between raw modularity and motion for each of the 4 runs
for (i in 1:4){
  assign("data",get(paste0("null_alldata",i)))
  null_modul=numeric(6)
   for (l in 1:6){
    assign("metric", metrics[l])
    temp <- data %>% dplyr::select(.,matches(paste0("^",metric,"$")))
    #print(colnames(temp))
    # temp2 <- cbind(temp$Age_numeric, temp[3])
    null_modul[l]<- mean(temp[,1])
     
   }
    assign(paste0("null_modul_estimate_run",i),data.frame(null_modul, metrics))
}
#create an id variable in the all dataframe created earlier
all$type <- "empirical"
#Melt them together
all_null <- cbind(null_modul_estimate_run1, null_modul_estimate_run2, null_modul_estimate_run3, null_modul_estimate_run4)
all_null$metrics <- factor(all_null$metrics, levels=c("Pearson", "Spearman", "Coherence", "WaveletCoherence", "MutualInformation","MutualInformationTime"), labels=c("P", "S", "MIT", "C","WC", "MIF") )
colnames(all_null) <- c("estimate1", "metrics", "estimate2","metrics", "estimate3", "metrics","estimate4", "metrics")
all_null$type <- "null"
all_null <- melt(all_null, id.vars = c("metrics", "type"))
everything <- rbind(all,all_null)
#Plot them like Arun, using his colors
p<-ggplot(everything, aes(x=metrics, y=value, color=type)) + 
  geom_jitter(position=position_jitter(0.2), cex=2.5)
p + theme_classic() + stat_summary(fun.data="mean_sdl",fun.args = list(mult = 1) ,
                 geom="pointrange", shape=95, cex=1) + labs(title="100-node Yeo parcellation",x="", y = "Modularity quality index (Q)")+ theme(plot.title = element_text(hjust = 0.5), legend.position = "none")+ theme(axis.text=element_text(size=14),
        axis.title=element_text(size=14)) +scale_color_manual(values=c("#0072BD", "#D95319", "#EDB120", "#7E2F8E", "#77AC30", "#4DBEEE"))
```